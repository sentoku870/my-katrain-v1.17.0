# 変更履歴（CHANGELOG）

> このファイルは myKatrain の Phase 1-59 の変更履歴を記録しています。
> CLAUDE.md から分離されました（2026-01-24）。

---

- 2026-01-25: Phase 59 完了（Pacing & Tilt Core）
  - 更新: `katrain/core/analysis/time/pacing.py`（新規、~360行）
    - `analyze_pacing()`: メインエントリポイント
    - `PacingConfig`: 設定パラメータ dataclass
    - `PacingMetrics`: 手ごと分類 dataclass
    - `TiltEpisode`: 連鎖ミスエピソード dataclass
    - `TiltSeverity`: 重大度 Enum（MILD/MODERATE/SEVERE）
    - `GamePacingStats`: ゲーム統計 dataclass
    - `LossSource`: 損失ソース Enum（SCORE/LEELA/POINTS/NONE）
  - 機能:
    - プレイヤー別メディアン基準で早打ち/長考判定
    - Strict '>' トリガー条件でティルトエピソード検出
    - p90損失を超える連鎖ミスをグループ化
    - Best-effort coverage gap handling
    - 混合エンジン検出（KataGo + Leela）
    - 決定論的Severity分類（SEVERE > MODERATE > MILD）
  - 更新: `katrain/core/analysis/time/__init__.py`
    - Phase 59 exports追加
  - 新規: `tests/test_pacing.py`（42件）
  - テスト総数: 2392件
- 2026-01-25: Phase 58 完了（Time Data Parser）
  - 新規: `katrain/core/analysis/time/` パッケージ
    - `models.py`: TimeMetrics, GameTimeData dataclass
    - `parser.py`: parse_time_data(), _extract_time_left()
    - `__init__.py`: 公開API exports
  - 機能:
    - SGF時間タグ（BL/WL）の解析・正規化
    - 手ごとの消費時間計算（差分計算）
    - 整数・小数形式対応（IGS/KGS等）
    - 浮動小数点許容誤差（EPS=0.001）
    - Graceful degradation:
      - 時間データなし → has_time_data=False
      - タグ欠損 → time_left_sec=None
      - 秒読みリセット → time_spent_sec=None + 警告ログ
  - 更新: `docs/01-roadmap.md`
    - Phase 58 受け入れ条件を詳細化
  - 新規: `tests/test_time_parser.py`（22件）
  - テスト総数: 2341件
- 2026-01-25: Phase 57 完了（Style Karte Integration）
  - 更新: `katrain/core/reports/karte_report.py`
    - `_build_tag_counts_from_moves()`: MeaningTagIdカウント集計
    - `_compute_style_safe()`: スタイル計算（エラー時None返却）
    - Meta出力にStyle/Style Confidence行追加
  - 更新: `katrain/i18n/locales/*/katrain.po`
    - 6件のスタイル名i18nキー追加（en/jp）
    - `style:kiai_fighter:name` → "Kiai Fighter" / "剛腕ファイター"
    - `style:cosmic_architect:name` → "Cosmic Architect" / "大局観の建築家"
    - `style:precision_machine:name` → "Precision Machine" / "精密機械"
    - `style:shinobi_survivor:name` → "Shinobi Survivor" / "忍びの生存者"
    - `style:ai_native:name` → "AI Native" / "AI世代"
    - `style:balance_master:name` → "Balance Master" / "バランスマスター"
  - 新規: `tests/test_karte_style_integration.py`（12件）
  - ゴールデンファイル更新（4件）
  - テスト総数: 2319件
- 2026-01-25: Phase 56 完了（Style Archetype Core）
  - 新規: `katrain/core/analysis/style/` パッケージ
    - `models.py`: StyleArchetypeId, StyleArchetype, StyleResult, STYLE_ARCHETYPES
    - `analyzer.py`: determine_style(), compute_confidence(), scores_are_tied()
    - `__init__.py`: 公開API exports
  - 6アーキタイプ定義:
    - KIAI_FIGHTER（剛腕ファイター）: Fighting高、Stability低
    - COSMIC_ARCHITECT（天空の構想家）: Opening高、Endgame低
    - PRECISION_MACHINE（精密機械）: Endgame高、Fighting低
    - SHINOBI_SURVIVOR（シノビの達人）: Stability高、Opening低
    - AI_NATIVE（新人類）: Awareness高
    - BALANCE_MASTER（バランスマスター）: フォールバック
  - 判定ロジック:
    - 相対評価: 5軸平均からの偏差で判定
    - バランス優先ルール: max|deviation| < 0.5 → 常にBALANCE_MASTER
    - 決定論的タイブレーク: Enum定義順
    - 浮動小数点tolerance: math.isclose(abs_tol=1e-9)
  - 新規: `tests/test_style_analyzer.py`（30件）
  - テスト総数: 2307件
- 2026-01-25: Phase 55 完了（Report Foundation + User Aggregation）
  - 新規: `katrain/core/reports/` レポート基盤
    - `sections/registry.py`: セクションレジストリ
    - `sections/types.py`: SectionRegistration, SectionWriter型定義
  - 新規: `katrain/core/analysis/user_aggregate.py`
    - UserAggregateStore: ユーザー別レーダー履歴管理
    - GameRadarEntry, UserRadarAggregate dataclass
  - テスト総数: 2277件
- 2026-01-25: Phase 54 完了（Report Quality Improvements）
  - 新規: `escape_markdown_table_cell()` 追加（helpers.py）
    - テーブルセルの安全なエスケープ（`[`, `]`, `|`, 改行対応）
  - 更新: `katrain/core/batch/stats.py`
    - `lang` パラメータ追加（`run_batch()`, `build_player_summary()`）
    - 12+ローカライズヘルパー関数追加（JP/EN両言語対応）
    - タグベース練習ヒント追加（MeaningTag / ReasonTag）
    - パーセンテージ注記追加
    - 色偏り注記追加（全黒番/白番の注意書き）
  - 更新: `katrain/core/batch/orchestration.py`
    - `lang` パラメータ追加
  - 更新: `katrain/core/reports/karte_report.py`
    - WR Gap説明改善（JP/EN両言語対応）
  - 新規テスト: `TestEscapeMarkdownTableCell`（9件）
  - ゴールデンファイル更新（カルテ＋サマリ）
  - テスト総数: 2237件
- 2026-01-24: Phase 53 完了（Batch Report基盤）
  - 新規: `katrain/core/batch/helpers.py` にヘルパー関数追加
    - `truncate_game_name()`: ゲーム名短縮（head+tail保持）
    - `format_wr_gap()`: WR Gap表示フォーマット（クランプ＋精度）
    - `make_markdown_link_target()`: マークダウンリンク生成（URL-encode対応）
  - 更新: `katrain/core/batch/stats.py`
    - Top 10 Worst Movesテーブルに「カルテ」列追加
    - `build_player_summary()` 署名更新（karte_path_map, summary_dir）
  - 更新: `katrain/core/batch/orchestration.py`
    - `karte_path_map` 構築＋サマリビルダーへ渡す
  - 更新: `katrain/core/reports/karte_report.py`
    - "Best Gap" → "WR Gap" リネーム
    - WR Gap表示精度改善
  - 更新: `katrain/core/analysis/presentation.py`
    - `get_auto_confidence_label()` 追加（推定確度 vs 信頼度 分離）
  - ローカライズ: "Practice Priorities" → "練習の優先順位"
  - 新規: `tests/test_batch_helpers.py`（12件）
  - ゴールデンファイル更新（カルテ＋サマリ）
  - テスト総数: 2199件
- 2026-01-24: Phase 52 完了（Stabilization & Documentation）
  - PR-1（B1）: `docs/02-code-structure.md` を Phase 21-52 に対応
    - 10モジュールのセクション追加（skill_radar, critical_moves, meaning_tags, lexicon等）
  - PR-2（B2）: Radar ゴールデンテスト実装
    - 新規: `tests/test_golden_radar.py`（17件: 15 P0 + 2 P1）
    - 追加: `tests/conftest.py` に `round_half_up()`, `_stabilize_float()`, `normalize_radar_output()`
    - 新規: `tests/fixtures/golden/radar_*.golden.json`（2ファイル）
    - 3段階ワークフロー: 生成→3回安定性検証→変更なし確認
  - PR-2（B3）: スキップテスト理由更新
    - `test_critical_moves.py` の4件を Phase 53 延期
    - バグ発見: `select_critical_moves` が未定義 `build_eval_snapshot` をインポート
  - PR-3（B4）: ベンチマークスクリプト作成
    - 新規: `scripts/benchmark_batch.py`（~180行）
    - `extract_game_stats()` のパフォーマンス計測
    - `--threshold`, `--strict` オプション対応
  - PR-3（B5）: ドキュメント最終化
    - 更新: `CLAUDE.md`（Phase 52 完了エントリ）
    - 更新: `docs/01-roadmap.md`（Phase 52: 完了ステータス）
  - テスト総数: 2187件
- 2026-01-23: Phase 52-A 完了（Tofu Fix + Language Code Consistency）
  - 新規: `katrain/common/locale_utils.py`（~100行）
    - `normalize_lang_code()`: 内部正規コード（"en"/"jp"）への変換
    - `to_iso_lang_code()`: ISO 639-1コード（"en"/"ja"）への変換
    - 地域バリアント対応: "ja_JP", "ja-JP" → "jp"
    - 大文字小文字非依存: "JP", " jp " → "jp"
  - 更新: `katrain/common/__init__.py`（エクスポート追加）
  - 更新: `katrain/core/analysis/meaning_tags/integration.py`
    - `normalize_lang = to_iso_lang_code` エイリアス（後方互換）
  - 豆腐修正: 以下のウィジェットに`font_name=Theme.DEFAULT_FONT`追加
    - `quiz_popup.py`: header_label, btn, start_button, close_button
    - `settings_popup.py`: search_input, search_clear_btn, タブヘッダー
    - `popups.kv`: LabelledTextInput, LabelledPathInput
  - テスト25件追加（test_locale_utils.py）
  - テスト総数: 2186件
- 2026-01-23: Phase 51 完了（Radar UI Widget）
  - 新規: `katrain/gui/widgets/radar_geometry.py`（~150行）
    - 純粋幾何関数（Kivy非依存、CI安全）
    - `calculate_vertex()`: 軸インデックス＋スコアから座標計算
    - `get_label_position()`: 軸ラベル位置（calculate_vertexと同じ角度公式）
    - `tier_to_color()`: Tier文字列→RGBA色変換
    - 座標系: 軸0（Opening）が12時、時計回り（角度減少）
  - 新規: `katrain/gui/widgets/radar_chart.py`（~160行）
    - `RadarChartWidget`: RelativeLayout継承、DictProperty安全パターン
    - グリッドリング固定比率（20%, 40%, 60%, 80%, 100%）
    - `Clock.create_trigger()`でデバウンス再描画
    - 頂点ドット色分け（Tier 4-5緑、3黄、1-2赤、unknown灰）
  - 新規: `katrain/gui/features/skill_radar_popup.py`（~200行）
    - Black/Whiteタブ切替（既存i18nキー再利用）
    - 弱軸（Tier 1-2）ハイライト表示
    - 19x19制限、MIN_MOVES_FOR_RADAR検証
  - 更新: `katrain/__main__.py`（`_do_skill_radar_popup()`追加）
  - 更新: `katrain/gui.kv`（MyKatrainメニュー項目追加）
  - 更新: `katrain/i18n/locales/*/katrain.po`（9キー追加）
  - テスト45件追加（31 geometry + 14 popup）
  - テスト総数: 2161件
- 2026-01-23: Phase 50 完了（Critical 3 Focused Review Mode）
  - 新規: `katrain/core/analysis/critical_moves.py`（~455行）
    - `CriticalMove` frozen dataclass: LLMプロンプト生成用14フィールド
    - `select_critical_moves()`: 重要度ベース選択（多様性ペナルティ付き）
    - `MEANING_TAG_WEIGHTS`: 12タグの学習価値重み（life_death_error=1.5等）
    - `DIVERSITY_PENALTY_FACTOR = 0.5`: タグ重複時のペナルティ係数
    - Decimal ROUND_HALF_UP: 決定論的丸め（同じゲーム→同じ結果）
  - 更新: `katrain/core/reports/karte_report.py`
    - `_critical_3_section_for()`: Critical 3セクション生成（Markdown/JSON）
    - `CRITICAL_3_PROMPT_TEMPLATE`: LLMプロンプトテンプレート
    - `build_critical_3_prompt()`: プロンプトビルダー関数
  - 更新: `katrain/core/analysis/__init__.py`（再エクスポート追加）
  - 新規: `tests/helpers_critical_moves.py`（~302行）
    - `StubGameNodeWithAnalysis`: analysis data付きスタブ
    - `build_stub_game_with_analysis()`: テスト用ゲームビルダー
    - `create_test_snapshot()`, `create_test_snapshot_with_tags()`
  - テスト50件追加（36 unit + 14 integration）
  - テスト総数: 2116件
- 2026-01-23: Phase 49 完了（Radar Aggregation & Summary Integration）
  - 更新: `katrain/core/analysis/skill_radar.py`（+357行）
    - `AggregatedRadarResult` frozen dataclass: 複数局集約結果
    - `aggregate_radar()`: 均等重み、per-axis UNKNOWNフィルタリング
    - `radar_from_dict()`: roundtripシリアライゼーションヘルパー
    - `round_score()`: Decimal ROUND_HALF_UPで決定論的丸め
    - 定数: `MIN_VALID_AXES_FOR_OVERALL=3`, `MIN_MOVES_FOR_RADAR=10`
  - 更新: `katrain/core/batch/stats.py`（+196行）
    - `extract_game_stats()`: radar_by_player計算（19x19のみ）
    - `build_player_summary()`: Skill Profileセクション追加
    - 定数: `TIER_LABELS`, `AXIS_LABELS`, `AXIS_PRACTICE_HINTS`
  - 更新: `__init__.py`（再エクスポート追加）
  - i18n: EN/JP radar tier/axis翻訳キー追加（13キー）
  - テスト60件追加（38 aggregation + 22 integration）
  - テスト総数: 2066件
- 2026-01-23: Phase 48 完了（5-Axis Radar Data Model）
  - 新規: `katrain/core/analysis/skill_radar.py`（~570行）
    - `RadarAxis` enum: 5軸（Opening, Fighting, Endgame, Stability, Awareness）
    - `SkillTier` enum: TIER_1-5 + TIER_UNKNOWN（str継承、int mapping付き）
    - `RadarMetrics` frozen dataclass: MappingProxyTypeでimmutability保証
    - Tier変換関数: APL/BlunderRate/MatchRate → Tier（半開区間閾値）
    - `is_garbage_time()`: BLACK視点winrate >= 0.99 or <= 0.01
    - `compute_overall_tier()`: 5軸median、math.ceil for even counts
    - `compute_radar_from_moves()`: MoveEvalリストから5軸計算
  - 更新: `__init__.py`（再エクスポート追加）
  - 制約: 19x19のみ（OPENING_END_MOVE=50, ENDGAME_START_MOVE=150）
  - テスト95件追加
  - テスト総数: 2006件
- 2026-01-23: Phase 47 完了（Meaning Tags Integration）
  - 新規: `katrain/core/analysis/meaning_tags/integration.py`
    - `normalize_lang()`: 言語コード正規化（"jp" → "ja"）
    - `get_meaning_tag_label_safe()`: 安全なラベル取得（None対応）
    - `format_meaning_tag_with_definition()`: 30文字truncation付き表示
  - MoveEval拡張: `meaning_tag_id: Optional[str]`フィールド追加
  - batch/stats.py: `meaning_tags_by_player`統計、Top 3 Mistake Typesセクション
  - karte_report.py: `lang`パラメータ、MTag列、JSON meaning_tagオブジェクト
  - Python 3.9互換性修正（`float | None` → `Optional[float]`）
  - テスト49件追加
  - テスト総数: 1946件
- 2026-01-23: Phase 46 完了（Meaning Tags System Core）
  - 新規: `katrain/core/analysis/meaning_tags/`パッケージ
    - `models.py`: MeaningTagId enum（str継承）、MeaningTag dataclass（frozen）
    - `registry.py`: MEANING_TAG_REGISTRY（12タグ定義、5つにLexiconアンカー）
    - `classifier.py`: 分類ヒューリスティクス（~500行）
    - `__init__.py`: 公開API + 閾値定数エクスポート
  - 12タグ分類: missed_tesuji, overplay, slow_move, direction_error, shape_mistake,
    reading_failure, endgame_slip, connection_miss, capture_race_loss,
    life_death_error, territorial_loss, uncertain
  - ヘルパー: get_loss_value(), classify_gtp_move(), compute_move_distance(), is_endgame()
  - Lexicon統合: resolve_lexicon_anchor()（モックフレンドリー設計）
  - テスト197件追加（classifier 93 + models 24 + registry 73 + integration 7）
  - テスト総数: 1867件
- 2026-01-23: Phase 45 完了（Lexicon Core Infrastructure）
  - 新規: `katrain/common/lexicon/`パッケージ（Kivy非依存）
    - `models.py`: frozen dataclass（LexiconEntry, DiagramInfo, AIPerspective）
    - `validation.py`: 2段階パイプライン + 例外クラス
    - `store.py`: LexiconStoreクラス（スレッドセーフ、アトミックスナップショット）
    - `__init__.py`: 公開API + get_default_lexicon_path()
  - 設計: 完全イミュータブル（frozen=True + Tuple[str, ...]）
  - 機能: get(), get_by_title(), get_by_category(), get_by_level()
  - バリデーション: 必須フィールド、Level 3専用、参照ID、タイトル衝突
  - 環境変数: LEXICON_PATH でパスオーバーライド可能
  - 依存: PyYAML追加（pyproject.toml）
  - テスト111件追加
  - テスト総数: 1665件
- 2026-01-21: Phase 44 完了（Batch Analysis Fixes）
  - Issue 1: 信頼性閾値の一貫性修正
    - `target_visits`パラメータを`extract_game_stats()`, `build_karte_report()`に追加
    - カウントと表示で同じ有効閾値を使用（例: visits=100→threshold=90）
    - 修正: batch/stats.py, batch/orchestration.py, karte_report.py, game.py
  - Issue 2: バッチ完了チャイム
    - 新規: `tools/generate_chime.py`（Python標準ライブラリのみでWAV生成）
    - 新規: `katrain/sounds/complete_chime.wav`（A major chord、0.4秒）
    - 定数: `Theme.COMPLETION_CHIME_SOUND`追加
    - 更新: batch_core.pyで石音の代わりにチャイムを使用
  - テスト7件追加
  - テスト総数: 1554件
- 2026-01-20: Phase 43 完了（Stability Audit）
  - Issue 1 (P0): Config save atomic化（tempfile + os.replace + os.fsync）
  - Issue 2 (P0): save_config() エラーハンドリング（`_save_config_with_errors()`抽出）
  - Issue 3 (P1): Leela shutdown TimeoutExpired二重発生対応
  - Issue 4 (P1): LeelaEngine analysis thread join（kill後に実行）
  - Issue 5 (P2): Theme loader新規モジュール（encoding + hasattr）
  - 新規: `katrain/gui/theme_loader.py`（~35行）
  - テスト18件追加（4ファイル）
  - テスト総数: 1529件
- 2026-01-20: Phase 42-C 完了（Batch Import Tests）
  - 新規: `tests/test_batch_core_imports.py`（19件）
  - 後方互換テスト: tools.batch_analyze_sgfからのインポート検証
  - 新APIテスト: core.batchからのインポート検証
  - 動作テスト: parse_timeout, get_canonical_loss, safe_int等
  - テスト総数: 1511件
- 2026-01-20: Phase 42-B 完了（Batch Orchestration移行）
  - 新規: `katrain/core/batch/analysis.py`（~394行、analyze_single_file, analyze_single_file_leela）
  - 新規: `katrain/core/batch/orchestration.py`（~439行、run_batch）
  - 新規: `katrain/core/batch/stats.py`（~961行、extract_game_stats, build_player_summary等）
  - 拡張: `__init__.py`にlazy `__getattr__`追加（重量モジュールの遅延インポート）
  - 軽量化: tools/batch_analyze_sgf.py（~1900行→~240行、CLI + 再エクスポートのみ）
  - 更新: gui/features/batch_core.py, batch_ui.pyのインポート先変更
  - テスト総数: 1492件
- 2026-01-20: Phase 42-A 完了（Batch Core移行）
  - 新規: `katrain/core/batch/`パッケージ（Kivy非依存）
  - models.py: WriteError, BatchResult dataclass
  - helpers.py: 純粋関数15種（choose_visits_for_sgf, safe_int, needs_leela_karte_warning等）
  - 後方互換: tools/batch_analyze_sgf.pyから再エクスポート
  - アーキテクチャテスト: test_batch_does_not_import_kivy()追加
  - テスト総数: 1492件
- 2026-01-20: Phase 41 完了（コード品質リファクタリング）
  - Phase 41-A: `AnalysisMode(str, Enum)` + `parse_analysis_mode()`関数（constants.py）
  - Phase 41-B: コマンドハンドラ抽出（gui/features/commands/パッケージ新設）
  - Phase 41-C: 例外ハンドリング改善（`# noqa: BLE001`、OUTPUT_ERROR統一）
  - Phase 41-D: Magic Number定数化（AI_ACCURACY_DECAY_BASE等3定数）
  - テスト14件追加（test_analysis_mode.py）
  - テスト総数: 1491件
- 2026-01-19: Phase 40 完了（Leela Zero対戦機能）
  - AI_LEELA定数追加（constants.py）、AI_STRATEGIES/RECOMMENDED_ORDER/STRENGTH統合
  - LeelaStrategy + LeelaNotAvailableError実装（ai.py、~90行）
  - config.json: `ai:leela: {}`と`leela.play_visits: 500`追加
  - __main__.py: LeelaNotAvailableErrorキャッチ＋ステータスバー表示
  - settings_popup.py: Play Visits UI追加
  - i18n: EN/JP翻訳追加（10キー）
  - テスト14件（test_leela_strategy.py）
  - テスト総数: 1477件
- 2026-01-19: Phase 39 完了（エンジン比較ビュー）
  - PR-1: `katrain/core/analysis/engine_compare.py`（~400行）
    - `ComparisonWarning` enum、`MoveComparison`/`EngineStats`/`EngineComparisonResult` dataclass
    - `build_comparison_from_game()` 関数
    - `compute_spearman_manual()` 手動Spearman相関（scipy不使用）
  - PR-1: テスト38件（test_engine_compare.py）
  - PR-2: `katrain/gui/features/engine_compare_popup.py`（~660行）
    - タブ切替UI（手別比較 / 統計サマリー）
    - ScrollView固定 + 乖離フィルタ（デフォルトON）
    - 行クリックで該当手にジャンプ
  - PR-2: MyKatrainメニューに「エンジン比較」項目追加
  - PR-2: i18n 35+キー追加（en/jp）
  - テスト総数: 1463件
- 2026-01-18: Phase 38 完了（安定化）
  - PR-1: `_safe_int()` ヘルパー関数（batch_core.py、サイレントデフォルト処理）
  - PR-1: `save_manifest()`, `save_player_profile()` にtry-except追加（io.py）
  - PR-1: `BaseEngine.on_error` のprint()削除、サブクラスでオーバーライド
  - PR-1: `_stderr_thread` のprint()をkatrain.log()に変更（engine.py）
  - PR-1: shutdown例外にOUTPUT_EXTRA_DEBUGログ追加（engine.py）
  - PR-1: `extract_analysis_from_sgf_node()` 例外具体化 + binasciiインポート（summary_stats.py）
  - PR-1: テスト8件（test_batch_validation.py）
  - PR-2: Game初期化/playテスト9件（test_game_core.py、test_board.pyパターン踏襲）
  - テスト総数: 1425件
- 2026-01-18: Phase 37 完了（テスト強化）
  - PR-2: `MixedEngineSnapshotError` 専用例外導入（karte_report.py）
  - PR-2: `KARTE_ERROR_CODE_*` エラーコード定数導入
  - PR-2: `is_single_engine_snapshot()` 混合エンジン検出関数
  - PR-2: `needs_leela_karte_warning()` 純粋関数（batch_core.py）
  - PR-2: T1混合エンジン防止テスト（test_mixed_engine_guard.py、17件）
  - PR-2: T2 Leela+karte警告テスト（test_batch_engine_option.py拡張）
  - PR-2: T3 resolve_visits契約テスト（定数参照、test_analysis_strength.py）
  - PR-2: T4 config fallback契約テスト（test_analysis_engine_config.py）
  - PR-3: T6 Leelaゴールデンテスト（test_golden_karte.py、3件）
  - PR-3: ゴールデンファイル（karte_leela_standard.golden）
  - PR-3: UI visits_input disabled（Leela選択時、batch_ui.py）
  - テスト総数: 1408件
- 2026-01-18: Phase 36 完了（Leelaバッチ解析）
  - PR-2: `analyze_single_file_leela()` per-move解析関数（~180行）
  - PR-2: `run_batch()` 拡張（analysis_engine, leela_engine, per_move_timeout）
  - PR-2: エンジン検証（バッチ開始時Leela aliveチェック）
  - PR-2: テスト13件（test_batch_leela_analysis.py）
  - PR-1: `LeelaEngine.is_idle()` メソッド（スレッドセーフ）
  - PR-1: `cancel_analysis()` ロック保護
  - PR-1: Batch UIエンジン選択行（KataGo/Leela切替）
  - PR-1: `collect_batch_options()` に `analysis_engine` 追加
  - PR-1: i18n 5キー追加
  - PR-1: テスト22件（test_leela_engine_idle.py, test_batch_engine_option.py）
  - 制限: Leelaカルテ生成は未対応（Phase 36 MVP）
- 2026-01-18: Phase 35 完了（Leelaカルテ統合）
  - 新規: `has_loss_data()` 関数（MoveEvalに損失データが存在するか判定）
  - 新規: `format_loss_with_engine_suffix()` 関数（Leelaは「(推定)」サフィックス付き）
  - 拡張: `worst_move_for()` がLeela対応（has_loss_data()ベースで0.0も候補に含む）
  - 拡張: `summary_lines_for()`, `opponent_summary_for()` のworst move表示
  - 拡張: Important Moves table の Loss 列にエンジンサフィックス
  - テスト: 21件（test_karte_leela_integration.py）
- 2026-01-18: Phase 33 完了（エンジン選択設定）
  - 新規: `VALID_ANALYSIS_ENGINES: FrozenSet[str]`（EngineTypeから派生、UNKNOWN除外）
  - 新規: `DEFAULT_ANALYSIS_ENGINE` 定数（"katago"）
  - 新規: `get_analysis_engine()` 関数（unhashable型ガード付き）
  - 設定: `engine.analysis_engine` キー追加
  - テスト: 30件（test_analysis_engine_config.py）
- 2026-01-18: Phase 32 完了（レポートLeela対応）
  - 新規: `EngineType` enum（KATAGO/LEELA/UNKNOWN）
  - 新規: `detect_engine_type()` 関数（MoveEvalからエンジン種別推定）
  - 拡張: `get_canonical_loss_from_move()` にleela_loss_est対応+全クランプ
  - 新規: `format_loss_label()` 関数（エンジン種別ラベルフォーマット）
  - 更新: `format_evidence_examples()`, `karte_report.py` Leela対応
  - テスト: 35件（test_engine_type_labels.py）
- 2026-01-18: Phase 31 完了（Leela→MoveEval変換）
  - 新規: `katrain/core/leela/conversion.py`（変換モジュール、~280行）
  - 新規: `MoveEval.leela_loss_est` フィールド（Leela Zero推定損失）
  - 機能: `leela_position_to_move_eval()` 単一手変換
  - 機能: `leela_sequence_to_eval_snapshot()` シーケンス変換（検証付き）
  - 機能: Winrate視点変換（side-to-move → black perspective）
  - テスト: 36件（test_leela_conversion.py）
- 2026-01-18: Phase 30 完了（解析強度抽象化）
  - 新規: `AnalysisStrength` enum（QUICK/DEEP、エンジン共通抽象）
  - 新規: `ENGINE_VISITS_DEFAULTS` 定数（KataGo/Leela別デフォルト値）
  - 新規: `resolve_visits()` 関数（防御的パース、フォールバック付き）
  - 新規: `LEELA_FAST_VISITS_MIN` 定数（UI最小値 50）
  - 設定: `leela.fast_visits` 追加（デフォルト 200）
  - UI: Settings > Leela > Fast Visits 入力欄追加（clampバリデーション付き）
  - テスト: 28件（test_analysis_strength.py）
- 2026-01-17: Phase 29 完了（Diagnostics + Bug Report Bundle）
  - 新規: `common/sanitize.py`（パス/テキストサニタイズ、Kivy非依存）
  - 新規: `core/log_buffer.py`（スレッドセーフな循環ログバッファ）
  - 新規: `core/diagnostics.py`（システム情報収集、ZIP生成）
  - 新規: `gui/features/diagnostics_popup.py`（診断ポップアップUI）
  - 機能: MyKatrain メニュー → Diagnostics で診断画面表示
  - 機能: Bug Report ZIP生成（プライバシー保護付き）
  - テスト: 71件（test_sanitize.py, test_log_buffer.py, test_diagnostics.py）
- 2026-01-17: Phase 28 完了（Smart Kifu運用強化）
  - 新規: `ImportErrorCode` enum（文字列マッチング脆弱性を解消）
  - 新規: `TrainingSetSummary` dataclass（サマリー計算）
  - 拡張: `import_sgf_to_training_set()` に `compute_ratio` オプション追加
  - 新規: `import_analyzed_sgf_folder()` バッチ出力フォルダのインポート
  - 機能: Training Set Manager に解析率表示（色分け付き）
  - 機能: バッチインポートダイアログ（`show_import_batch_output_dialog()`）
  - テスト: 36件（test_smart_kifu_analyzed_ratio.py, test_smart_kifu_import.py）
- 2026-01-17: Phase 27 完了（Settings UIスケーラブル化）
  - 新規: `common/settings_export.py`（Export/Import/Resetロジック、Kivy非依存）
  - 拡張: `gui/features/settings_popup.py`（検索バー、Export/Import/Resetボタン）
  - 機能: 設定検索、設定Export/Import（JSON）、タブ別リセット
  - テスト: 22件（test_settings_export.py）
- 2026-01-17: Phase 26 完了（レポート導線改善）
  - 新規: `common/file_opener.py`（クロスプラットフォームファイル/フォルダオープナー）
  - 新規: `gui/features/report_navigator.py`（レポート導線UI）
  - 機能: 「最新レポートを開く」「出力フォルダを開く」メニュー項目
- 2026-01-17: Phase 24 完了（SGF E2E Regression Tests）
  - 新規: `tests/helpers/` パッケージ（mock_analysis.py, stats_extraction.py）
  - 拡張: `tests/conftest.py`（CI検出、改行正規化）
  - 追加: TestKarteFromSGF, TestSummaryFromSGF（3 SGFファイル対応）
- 2026-01-16: Phase 20 完了、コード構造更新
  - core層のKivy依存を大幅削減（許可リスト6→1エントリ）
  - 新規: `common/platform.py`, `common/config_store.py`, `gui/lang_bridge.py`
  - 変更: `core/lang.py`（Observable→コールバックベース）
- 2025-12-30: v1.0 作成（Claude Code移行対応）
