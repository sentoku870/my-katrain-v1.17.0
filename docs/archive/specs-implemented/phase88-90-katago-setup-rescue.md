# myKatrain：PC初心者向け「KataGoセットアップ/救済」仕様案（ドラフト）

目的：**PC初心者でも「まず動く」状態に到達**でき、問題が起きても **必要情報を自動収集→自力復旧 or LLM相談**ができる導線を提供する。  
前提：本家KaTrainと基本機能は近い。差分は **迷いどころの削減**と **復旧導線の強化**に寄せる。

---

## 1. ゴールと非ゴール

### ゴール

- 初回起動で「解析が1回成功」する確率を最大化（成功体験）
- エラー時に「次の行動」がUIで分かる（復旧可能）
- バグ報告・動作チェック用に、**必要情報を指定フォルダへ自動吐き**できる

### 非ゴール（この仕様ではやらない）

- CUDA/TensorRT の自動セットアップ（依存関係が多く事故りやすい）
- 性能最適化の自動チューニング（benchmark→自動適用等）は保留  
  ※将来は「設定内容の表示」程度から段階追加

---

## 2. 概要（UXの柱）

- **自動（まず動かす）**：迷いゼロ。最小要件で確実に動く設定を自動選択し、失敗したらフォールバック。
- **標準（ガイド付き）**：推奨説明を読みながら「意味で選ぶ」。ファイル名/パスは原則見せない。
- **高機能（上級）**：CUDA/TensorRTは「案内＋動作テスト＋復帰」まで。セットアップ代行はしない。
- **human-like（実験）**：通常解析と**混ぜない**。トグルでON/OFFする（両方同時選択できない）。

---

## 3. 画面設計（KataGo設定の再構成）

### 3.1 セクション構成

- ① **モード選択**（ラジオ/タブ）
  - 自動（まず動かす）
  - 標準（推奨を見ながら）
  - 高機能（上級）
- ② **現在の構成（サマリ）**
  - エンジン：CPU/OpenCL/CUDA/TensorRT（ラベル）
  - 通常モデル：軽量/標準/強い（ラベル）
  - human-like：OFF/ON（ラベル）
  - 重要設定：探索数(Visits)、制限時間、スレッド等（表示のみでも可）
- ③ **詳細（Advanced）**：パスやcfg等の生情報はここに畳む
  - 「エクスプローラで選択」「フォルダを開く」「コピー」ボタンを各項目に付ける

---

## 4. human-like の仕様（事故原因の根治）

### 4.1 問題（現状）

- human-like が通常モデルと同列に見え、**両方同時に選べる**ように見える（罠）
- 「セットしたら動かない」ケースが出る（初心者が詰む）

### 4.2 改善仕様

- **human-like は専用トグル**で切り替え
  - `Human-like（実験）: OFF / ON`
- ONのときだけ「human-likeモデルパス」UIを表示・有効化
- **通常モデルのドロップダウンには human-like を絶対に出さない**
- **同時選択禁止**（内部的に排他）
  - 通常解析：通常モデル（b10/b18/b28等）
  - human-like解析：human-likeモデル（別スロット）
- UIテキスト（短文）
  - OFF時：`通常の解析（推奨）`
  - ON時：`人間らしい傾向を優先（精度や性質が変わる可能性）`

---

## 5. 自動（まず動かす）モード仕様

### 5.1 方針

- **最小要件で確実に動かす**（精度より成功率）
- 判定は「検出」より「実行テスト」を優先（起動して確かめる）

### 5.2 具体動作

1. エンジン候補を順に試す（例）
   - 1. OpenCL版でテスト解析
   - 2. 失敗したら CPU(Eigen/AVX2) に自動フォールバック
2. 通常モデルは **軽量モデルを固定**
   - 例：`kata1-b10c128-...` のような超軽量
   - 提供方法：同梱 or ワンクリックDL（後述）
3. 解析設定は固定（例）
   - `簡易解析 visits = 10`（ユーザー案）
   - `通常解析 visits = 100`（現状踏襲でも可、まずは控えめ推奨）
4. 成功後に表示する説明（1行）
   - `まず動作優先の設定です。精度を上げたい場合は「標準」へ切り替えて探索数を増やしてください。`

### 5.3 テスト解析（必須）

- 内蔵の小さな局面（9路など）または極小SGFで数手だけ解析
- 成功条件：エンジン起動→モデルロード→解析応答（例：PVが1本でも返る）
- 失敗条件：起動不可、モデル読めない、応答タイムアウト等
- 結果UI
  - ✅ 成功：`動作OK（エンジン: ○○ / モデル: 軽量）`
  - ❌ 失敗：原因カテゴリと次ボタン（後述）

---

## 6. 軽量モデルの扱い（b10c128 の同梱/DL）

### 6.1 方針

- 「CPUでも確実に動く」ための**安全ネット**を用意する（自動モード専用）
- ユーザーがファイル名を選ばなくていいように、**用途ラベル**で固定する

### 6.2 提供方式

- Option A（推奨）：**初回同梱**
  - Pros：ネットワーク不要、初回成功率最大
  - Cons：配布サイズ増
- Option B：ワンクリックDL（初回ウィザードで）
  - Pros：配布サイズ小
  - Cons：ネットワーク/失敗導線が必要

### 6.3 UI表示

- `自動用 軽量モデル（CPUでも動作）`（固定ラベル）
- 「場所を開く」「再ダウンロード」ボタン

---

## 7. 標準（ガイド付き）モード仕様

### 7.1 原則

- **ファイル名・パスを選ばせない**（意味で選ばせる）
- 選択肢を最小化（2〜3択）

### 7.2 選択肢（例）

- 通常モデル（ラベル選択）
  - `軽量（速い）`（b10系）
  - `標準（推奨）`（b18系）
  - `強い（重い）`（b28系）
- エンジン（ラベル選択）
  - `自動（OpenCL→CPU）`
  - `CPU固定`
  - `OpenCL固定`
- 右側に短い説明を表示（各1行）
  - `軽量：速いが精度低め`
  - `強い：精度高めだが重い`
  - `OpenCL：GPUがあれば速い（環境により失敗あり）`

### 7.3 “詳細”の扱い

- 「詳細を表示」で初めてパス・cfgを見せる
- 「コピー（LLM用）」導線をここに置く

---

## 8. 高機能（上級）モード仕様（CUDA/TensorRT）

### 8.1 方針

- アプリは **案内＋動作テスト**に徹する
- 「自動セットアップしない」代わりに、**必要情報を一括コピー**できるようにする

### 8.2 UI要件

- 選択肢
  - `CUDA版を使う（上級）`
  - `TensorRT版を使う（上級）`
- 必須ボタン
  - `動作テスト`（起動/解析の最小チェック）
  - `問題解決用の情報をコピー`（LLM相談用）
  - `標準へ戻す`（ワンクリック復帰）

### 8.3 LLM相談用コピーに入れる内容（最低限）

- OS/CPU/GPU名、ドライバ情報（取得可能範囲で）
- myKatrain/KaTrain/KataGoバージョン
- 選択中のbackend、実行ファイルパス（サニタイズ）
- 直近ログの重要行（末尾N行＋要約）
- 何をしたいかのテンプレ文（例：`CUDA/TensorRTで動かしたい。現状は...`）

---

## 9. エラー時の導線（初心者救済の要）

### 9.1 エラー分類（カテゴリ）

- パス/権限（モデル見つからない、書き込み不可）
- backend関連（OpenCL初期化失敗、GPU不一致）
- 設定過大（重すぎ、タイムアウト）
- その他（不明）

### 9.2 UIで必ず出すアクション

- `自動（まず動かす）へ戻す`
- `問題解決用の情報をコピー`
- `診断ファイルの保存（またはフォルダを開く）`
- `ログ全文をコピー`

---

## 10. 自動ダンプ（開発者機能寄り・標準搭載）

### 10.1 目的

- ユーザーが説明できなくても、**材料が揃う**
- 開発者が動作チェックしやすい

### 10.2 トリガ

- エンジン起動失敗
- テスト解析失敗
- 解析中に一定回数連続で失敗
- 例外（クラッシュ）検知時

### 10.3 出力

- 既定フォルダ：`<user_data>/diagnostics/`（例：`.katrain/diagnostics`）
- ファイル例
  - `diag-YYYYMMDD-HHMMSS.txt`
  - `engine-last-200-lines.txt`
  - `config-snapshot.json`（サニタイズ済み）
- 画面ボタン
  - `フォルダを開く`
  - `diagテキストをコピー`

### 10.4 サニタイズ（最低限）

- ユーザー名を含むパスはマスク（`C:\Users\<redacted>\...`）
- 個人情報が混ざり得る項目は出力しない（必要なら同意UI）

---

## 11. 受け入れ基準（Acceptance Criteria）

### human-like

- [ ] 通常モデル選択UIに human-like が表示されない
- [ ] human-like はトグルでON/OFFでき、ON時のみパスが有効化される
- [ ] 通常モデルとhuman-likeが同時に有効になる状態が存在しない（排他）

### 自動（まず動かす）

- [ ] 初回起動で「テスト解析」を1クリックで実行できる
- [ ] OpenCL失敗時にCPUへ自動フォールバックし、再テストされる
- [ ] 軽量モデル（b10系）が自動モードで必ず利用される（同梱 or DL成功）
- [ ] 成功時に「次は標準へ」等の案内が出る

### 標準（ガイド付き）

- [ ] “意味ラベル”でモデル/エンジンが選べ、ファイル名が露出しない（詳細を除く）
- [ ] すべての主要パスに「フォルダを開く」「エクスプローラで選択」「コピー」がある

### エラー救済

- [ ] エラー時に「自動へ戻す」「LLM用コピー」「診断フォルダを開く」が必ず出る
- [ ] エラー時に diagnostics フォルダへ自動でテキストが吐かれる（設定でOFFも可）

---

## 12. オープン事項（次に決めるだけの論点）

- 軽量モデルの提供方式：同梱(A)かDL(B)か（配布サイズと成功率のトレードオフ）
- 自動モードの visits：10固定でよいか、CPU/バックエンド別で微調整するか
- テスト解析の局面：内蔵SGF/9路/空局面どれが最も安定か
- diagnostics のサニタイズ範囲：どこまでを既定でマスクするか

---

## 13. 参考（現状UIから読み取れる改善点）

- human-like が通常モデルと同列に見え、混ざってしまう
- パスが前面に出ており、初心者は「何を選ぶべきか」で止まりやすい
- ここを「ラベル選択＋詳細に畳む」だけで体感が大きく改善する
