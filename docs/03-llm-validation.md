# LLM検証テンプレート：カルテ駆動の上達ループ

> このドキュメントは、myKatrain のカルテ機能と LLM（Claude / ChatGPT 等）を組み合わせて、囲碁の上達を **測定可能な形** で進めるための検証テンプレートです。

---

## 0. 前提知識

このテンプレートを使う前に、以下を理解してください：

### カルテの種類

- **デイリーコーチ（単局カルテ）**: 1局の振り返り用
  - 出力: `reports/karte/karte_YYYYMMDD-HHMM.md`
  - 操作: KaTrain の「Export Karte」ボタン
  - 特徴: Freedom（手の自由度）が計算される

- **ウィークリーコーチ（複数局サマリー）**: 直近N局の傾向分析用
  - 出力: `reports/summary_互先_YYYYMMDD-HHMM.md`
  - 操作: KaTrain の「Multi-game summary」メニュー
  - 特徴: Phase × Mistake クロス集計、弱点仮説の自動生成

### LLMへの入力方法（4ルート）

| ルート | 入力 | 用途 | 相談の質 |
|--------|------|------|----------|
| 1 | プロンプトのみ | 方向づけ | 1倍（一般論） |
| 2 | プロンプト + SGF/画像 | 具体例 | 1.5〜2倍 |
| 3 | プロンプト + 解析入りSGF | **非サポート** | - |
| 4 | プロンプト + カルテ | **推奨** | 2〜4倍以上 |

**このテンプレートはルート4（カルテ駆動）を前提とします。**

---

## 1. 検証サイクル（5ステップ）

Phase 9 の核心は、以下の5ステップを **測定可能な形で回す** ことです：

```
[1] カルテ生成
      ↓
[2] LLM診断（弱点特定）
      ↓
[3] 行動ルール策定（最大3つ）
      ↓
[4] 実践（次の5局）
      ↓
[5] 再カルテ（改善を測定）
      ↓
   （サイクル継続）
```

### 成功条件

- [ ] 5ステップを最低1回完走できる
- [ ] ステップ5で「改善した」または「変化なし」を客観的に判定できる
- [ ] 次のサイクルに引き継ぐ情報（継続する行動ルール、新しい弱点）が明確

---

## 2. ステップ詳細

### [1] カルテ生成

#### 1-A: 初回診断（ウィークリーコーチ）

直近10局のカルテを生成します。

**手順**:
1. KaTrain で「Analysis」→「Multi-game summary」を選択
2. 直近10局のSGFファイルを選択（KataGo解析済み）
3. 自分のプレイヤー名を選択
4. 「Generate Summary」をクリック
5. `reports/summary_互先_YYYYMMDD-HHMM.md` を確認

**確認ポイント**:
- [ ] Phase × Mistake Breakdown テーブルが表示される
- [ ] Weakness Hypothesis で上位3つの弱点が抽出されている
- [ ] Practice Priorities が1-2個に絞られている

#### 1-B: 継続診断（デイリーコーチ）

1局ごとの振り返り用。対局直後に実行します。

**手順**:
1. KaTrain で対局を開く（または検討中の対局）
2. 「Export Karte」ボタンをクリック
3. `reports/karte/karte_YYYYMMDD-HHMM.md` を確認

**確認ポイント**:
- [ ] Weakness Hypothesis (Focus Player) が表示される
- [ ] 行動ルールに沿った手が打てたか振り返る

---

### [2] LLM診断（弱点特定）

カルテをLLMに渡して、客観的な診断を受けます。

#### プロンプトテンプレート（ウィークリーコーチ）

```markdown
以下は私の直近10局の統計カルテです。
次の5局で改善すべき弱点を1つに絞り、行動ルールを最大3つ提案してください。

---
[カルテの内容を貼り付け]
---

## 診断の条件

1. **主テーマは1つだけ**（他は捨てる）
2. **行動ルールは最大3つ**（次の5局で守れる範囲）
3. **測定可能な成功条件を2つ**（次のカルテで確認できる指標）
4. **客観事実3点**（カルテから抽出）
5. **原因仮説は最大2つ**

## 出力形式

### 客観事実（カルテから抽出）
1. [Phase × Mistake の最悪の組み合わせ]
2. [損失の割合または頻度]
3. [もう1つの特徴的なデータ]

### 原因仮説
1. [仮説1]
2. [仮説2]

### 主テーマ
[1つに絞った課題]

### 行動ルール（次の5局で守る）
1. [具体的な行動1]
2. [具体的な行動2]
3. [具体的な行動3]

### 成功条件（次のカルテで測定）
1. [指標1]（例: 中盤の平均損失が30目以下に減る）
2. [指標2]（例: 大悪手が3回以下に減る）
```

#### プロンプトテンプレート（デイリーコーチ）

```markdown
以下は今日の対局のカルテです。
今日の対局で良かった点と改善点を1つずつ教えてください。

---
[カルテの内容を貼り付け]
---

## 診断の条件

1. **良かった点は1つだけ**（モチベーション維持）
2. **改善点は1つだけ**（次局で意識する）
3. **短く具体的に**（各20-30文字程度）

## 出力形式

### 良かった点
[具体的な良い手・判断]

### 改善点
[次局で意識すること]
```

---

### [3] 行動ルール策定

LLM診断を基に、次の5局で守る行動ルールを最大3つに絞ります。

#### ルール策定の原則

1. **具体的であること**
   - NG: 「中盤を改善する」
   - OK: 「戦いの前に『自分の石は安全か？』を確認」

2. **測定可能であること**
   - NG: 「もっと良く打つ」
   - OK: 「中盤の平均損失が30目以下」

3. **実行可能であること**
   - NG: 「全ての変化を読み切る」
   - OK: 「読みが不安なら、まず連絡・補強を優先」

#### 行動ルールの記録

行動ルールは以下の形式で記録します：

```markdown
# 行動ルール v[バージョン番号]

**作成日**: YYYY-MM-DD
**適用期間**: 次の5局（〜YYYY-MM-DD）
**主テーマ**: [1つに絞った課題]

## ルール

1. [行動1]
2. [行動2]
3. [行動3]

## 成功条件

1. [測定可能な指標1]
2. [測定可能な指標2]

## 根拠カルテ

- `summary_互先_YYYYMMDD-HHMM.md`
```

保存先: `reports/action_rules_vXX.md`

---

### [4] 実践（次の5局）

行動ルールを意識して、次の5局を打ちます。

#### 実践のポイント

- **対局前**: 行動ルールを1回読む（30秒）
- **対局中**: ルールを思い出せる範囲で意識（完璧を目指さない）
- **対局後**: デイリーコーチでルールを守れたか振り返る（任意）

#### 記録

各対局後に簡単なメモを残します（任意）：

```markdown
# 対局記録

## 対局1 (YYYY-MM-DD)
- SGF: `game1.sgf`
- ルール遵守: [〇/△/×] ルール1, ルール2, ルール3
- 気づき: [簡単なメモ]

## 対局2 (YYYY-MM-DD)
...
```

保存先: `reports/practice_log_vXX.md`

---

### [5] 再カルテ（改善を測定）

5局打ち終えたら、再度カルテを生成して改善を測定します。

#### 手順

1. 新しい5局を含めた直近10局で「Multi-game summary」を生成
2. `summary_互先_YYYYMMDD-HHMM.md` を確認
3. 前回のカルテと比較

#### 比較の観点

| 項目 | 前回 | 今回 | 判定 |
|------|------|------|------|
| 主な弱点（Phase × Mistake） | [例: Middle game の大悪手 (8回、52.1目)] | [新データ] | 改善/変化なし/悪化 |
| 成功条件1 | [例: 中盤の平均損失 38.9目] | [新データ] | 達成/未達 |
| 成功条件2 | [例: 大悪手 8回] | [新データ] | 達成/未達 |

#### 判定基準

- **改善**: 成功条件を1つ以上達成、かつ主な弱点の損失が10%以上減少
- **変化なし**: 成功条件を達成できず、損失の変化が±10%以内
- **悪化**: 主な弱点の損失が10%以上増加

#### 次のアクション

| 判定 | アクション |
|------|-----------|
| 改善 | 行動ルールを継続（次の5局） + 新しい弱点があれば追加ルール策定 |
| 変化なし | 行動ルールを見直す（LLMに再診断依頼） |
| 悪化 | 行動ルールを中止、別の弱点に焦点を変える |

---

## 3. テンプレート集

### 3-1. 初回診断用プロンプト

```markdown
# 初回診断依頼

以下は私の直近10局の統計カルテです。
囲碁の上達のため、次の5局で改善すべき弱点を1つに絞り、行動ルールを提案してください。

[カルテを貼り付け]

## 私の情報
- 棋力: 野狐4-5段
- 目標: 安定して5段を維持
- 困っていること: [自由記述]

## 診断の条件
1. 主テーマは1つだけ（他は捨てる）
2. 行動ルールは最大3つ（次の5局で守れる範囲）
3. 測定可能な成功条件を2つ
```

### 3-2. 継続診断用プロンプト

```markdown
# 継続診断依頼

前回の行動ルールで5局打ちました。
新しいカルテを見て、改善が見られるか判定してください。

## 前回のカルテ（参考）
[前回の Weakness Hypothesis と Practice Priorities を貼り付け]

## 前回の行動ルール
1. [ルール1]
2. [ルール2]
3. [ルール3]

## 今回のカルテ
[新しいカルテを貼り付け]

## 依頼内容
1. 改善/変化なし/悪化 を判定
2. 次の5局の行動ルールを提案（継続または見直し）
```

### 3-3. デイリー振り返り用プロンプト

```markdown
# デイリー振り返り

今日の対局のカルテです。
良かった点と改善点を1つずつ、短く教えてください。

[カルテを貼り付け]

## 現在の行動ルール
1. [ルール1]
2. [ルール2]
3. [ルール3]
```

---

## 4. 運用ルール

### 4-1. カルテの軽さを維持する

- カルテは「LLMに貼るための、軽くて客観的な証拠」
- 重要局面TopN + 集計だけで、PV（変化）は原則入れない

### 4-2. 学習ループを回す

- カルテ → 課題特定 → 行動ルール → 5局実践 → 再カルテ
- 1回の相談で「主テーマ1つ + 行動ルール最大3つ」に絞る

### 4-3. 主観とデータのズレを確認

- 「序盤が弱い」と思っていても、データで中盤の損失が3倍多いことがある
- カルテの客観データを優先し、主観は仮説として扱う

### 4-4. 複数の弱点を同時に直さない

- 人間は同時に2つ以上のことを意識できない
- 最も損失が大きい弱点1つに絞る

---

## 5. FAQ

### Q1: 5局は必須ですか？

A: いいえ。5局は目安です。以下の基準で調整してください：
- **短縮（3局）**: 明確な改善が見えた場合
- **延長（10局）**: 変化が小さく、もう少しデータが欲しい場合

### Q2: カルテが毎回同じ弱点を指摘します

A: それは **正常** です。弱点が根深い証拠です。
- 行動ルールを見直す（より具体的にする）
- 別の角度からアプローチする（例: 形勢判断ミス → 読み不足 の順に分解）

### Q3: LLMの診断が一般論すぎます

A: カルテの内容を十分に貼り付けていない可能性があります。
- Weakness Hypothesis
- Phase × Mistake Breakdown
- Top Worst Moves

の3セクションは必ず含めてください。

### Q4: デイリーコーチは毎局必要ですか？

A: いいえ。以下の場合のみ推奨：
- 重要な対局（大会、昇段がかかる対局）
- 行動ルールを守れたか不安な対局
- 特に学びがあった対局

---

## 6. 成功事例（想定）

### 事例1: 中盤の大悪手を減らす

**初回カルテ**:
- Middle gameの大悪手: 8回、損失52.1目

**行動ルール**:
1. 戦いの前に「自分の石は安全か？」を確認
2. 相手の弱点（呼吸点2以下）を見つけてから動く
3. 読みが不安なら、まず連絡・補強を優先

**5局後のカルテ**:
- Middle gameの大悪手: 3回、損失18.5目

**判定**: 改善（損失64%減）

**次のアクション**: 行動ルールを継続、Openingの悪手に焦点を追加

---

## 7. まとめ

Phase 9 の検証テンプレートは、以下を確立します：

- ✅ カルテ → LLM診断 → 行動ルール → 実践 → 再カルテ のサイクル
- ✅ 測定可能な成功条件（客観的な改善判定）
- ✅ 主テーマ1つ + 行動ルール最大3つ（実行可能な範囲）

このテンプレートを使って、**測れる形で上達**してください。

---

**最終更新**: 2025-12-31
**バージョン**: v1.0
**対応Phase**: Phase 9（検証テンプレで改善ループ）
