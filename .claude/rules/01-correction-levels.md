# 修正レベル定義（Correction Levels）

> このファイルは修正規模の判定基準を定義します。
> Claude Code は修正前に必ずレベルを判定し、適切なフローを選択してください。

---

## 1. レベル一覧

| Lv | 名称 | 規模イメージ | 対応方法 |
|:--:|------|-------------|----------|
| 0 | 超軽微 | コメント/文言/ログ追加（挙動ほぼ不変） | 直接修正 |
| 1 | 軽微 | 1ファイル、〜50行の小さなロジック修正 | 直接修正 |
| 2 | 中程度単一 | 1-2ファイル、〜100行、挙動が変わる修正 | Plan Mode → 承認 → 実行 |
| 3 | 複数ファイル | 2-3ファイル、UI＋ロジックなど | Plan Mode + 段階的実行 |
| 4 | 大規模 | 4ファイル超、構造変更を含む | 分割案を先に提示 |
| 5 | 根本変更 | 設計から見直すレベル | 設計相談のみ（実装保留） |

※行数は目安であり、厳密ではない。迷ったら上のレベルに寄せる（安全側）。

---

## 2. docs-only / code-change の境界

### docs-only（ドキュメントのみ）
- `docs/**/*.md`
- `katrain/i18n/**/*.po`（翻訳ファイル）
- README、CHANGELOG など

→ **main直接コミット可**（大改稿の場合は任意でPR）

### code-change（コード変更を含む）
- `.py` / `.kv` など実行時挙動に影響するファイル
- `.py` の表示文字列やコメント修正も code-change 扱い

→ **feature ブランチ + PR 必須**

### 迷ったら
**code-change（安全側）** として扱う。

---

## 3. レベル別の詳細

### Lv0: 超軽微
- **典型例**: 表示文言修正、コメント追加、ログ出力追加
- **回答で必ず書くこと**:
  - 変更ファイル名
  - 変更内容（1-2行）
  - 最短の確認手順

### Lv1: 軽微
- **典型例**: 1ファイル内の小さなバグ修正、小さなUI調整
- **回答で必ず書くこと**:
  - 変更ファイル名
  - 具体的な差分
  - 動作確認ポイント

### Lv2: 中程度単一
- **典型例**: 1-2ファイルで挙動が明確に変わる修正
- **回答で必ず書くこと**:
  - 「Lv2」宣言
  - 影響範囲（どの機能/画面が変わるか）
  - 簡単な動作確認手順

### Lv3: 複数ファイル
- **典型例**: UI＋ロジック＋翻訳など複数ファイルにまたがる修正
- **回答で必ず書くこと**:
  - 「Lv3」宣言
  - どのファイルを触るか
  - 破壊的変更の可能性（設定互換・保存データ互換）

### Lv4: 大規模
- **典型例**: 状態管理や主要設計を触る、クラス構造変更
- **回答で必ず書くこと**:
  - 変更の段階分割（フェーズ提案）
  - 「今回やる範囲 / やらない範囲」の線引き

### Lv5: 根本変更
- **典型例**: engineの前提やコアデータ構造の抜本変更
- **回答で必ず書くこと**:
  - 「Lv5」宣言
  - 目的と非目的
  - 分割案（Lv2-3に切り出せる単位）
  - 先に決めるべき仕様の質問

---

## 4. KaTrain固有の判断例

| 変更内容 | 判定 | 理由 |
|----------|------|------|
| `.kv` のUI文言修正 | code-change | Kivyレイアウト = 実行時挙動 |
| `.po` の翻訳更新のみ | docs-only | 翻訳ファイルはドキュメント扱い |
| 定数・閾値の微調整（`.py`） | code-change | Pythonコード = code-change |
| `docs/` 内のMarkdown修正 | docs-only | ドキュメントのみ |
| `analysis/` パッケージのロジック変更 | code-change (Lv2+) | コアロジック（models/logic/presentation） |
| `eval_metrics.py` の変更 | code-change (Lv1) | ファサードのみ（実体は analysis/） |

---

## 5. 変更履歴

- 2025-12-30: v1.0 作成（Claude Code移行対応）
