# 囲碁ドメイン（Go Domain）

> このファイルは囲碁に関する機能開発時の参照ガイドです。
> 棋力レベル定義、解説レベル定義、KataGo用語を含みます。

---

## 1. 棋力レベル定義（G0-G4）

ユーザー本人の棋力は **野狐4-5段（G4相当）** を想定。

| ラベル | 目安棋力 | 特徴 |
|:------:|----------|------|
| G0 | 〜10級 | ルール〜基本死活。対局経験少なめ |
| G1 | 5〜1級 | 一般アマ級位者。布石・定石は一部のみ |
| G2 | 初段〜二段 | 基本形理解あり。読み抜け・手筋抜けあり |
| G3 | 三〜四段 | 戦い強いがムラあり。ヨセに取りこぼし |
| G4 | 五段相当 | ユーザー本人。1-2分野に明確な弱点 |

### 説明の使い分け
- G0-G1: 「何を気にすべきか」を絞った説明
- G2: 「なぜそうなるか」の簡潔な理由を添える
- G3-G4: 手順や構想の裏付けも欲しいが、文章量は抑える

---

## 2. 解説レベル定義（A-D）

棋力（G0-G4）とは独立に、「どこまで言語化するか」を定義。

| ラベル | 概要 | 具体例 |
|:------:|------|--------|
| A | 方向性ヒント | 「黒は左辺を補強してから中央を狙う」 |
| B | 役割・構図ヒント | 「左辺の黒は弱石なので、安定させると上辺との戦いが楽」 |
| C | プロ構想レベル | 複数手先の構想と変化を文章で説明（重い） |
| D | KataGo構想レベル | あらゆる変化を網羅（非現実的、基本不採用） |

### 標準の組み合わせ
| 想定ユーザー | 推奨G | 推奨解説 |
|--------------|-------|----------|
| 入門〜級位者向け | G0-G1 | A メイン |
| 一般アマ向け | G1-G2 | A + 薄いB |
| 自分専用ツール | G3-G4 | B メイン + 必要ならC |

デフォルト: **G1-G2 / 解説=A + 薄いB**

---

## 3. KataGo 用語（開発時の参照）

### 3.1 基本指標

| 用語 | 説明 | 範囲 |
|------|------|------|
| `winrate` | 勝率 | 0.0-1.0（手番視点） |
| `scoreLead` | 目数リード | 正=手番有利、負=相手有利 |
| `scoreMean` | 平均目数（期待値） | scoreLead と近いが揺れやすい |
| `scoreStdev` | 目数の標準偏差 | 大きい=不確実な局面 |

### 3.2 候補手情報

| 用語 | 説明 |
|------|------|
| `move` | 座標（例: "D4", "pass"） |
| `visits` | 探索回数（信頼性の指標） |
| `prior` | 事前確率（policy由来） |
| `order` | 候補手の順位（0=最善手） |
| `pv` | Principal Variation（読み筋） |

### 3.3 損失計算（myKatrain独自）

| 用語 | 説明 | 計算方法 |
|------|------|----------|
| `score_loss` | 目数損失 | `|親のscore - 子のscore|` |
| `points_lost` | KaTrain標準の損失 | 同上（呼び方の違い） |
| `importance` | 重要度スコア | `max(points_lost, |Δscore|)` + 補正 |

### 3.4 信頼性フラグ（Phase 4.5で追加）

| フラグ | 条件 | 用途 |
|--------|------|------|
| `is_reliable` | visits >= 閾値 | 低visits手の除外 |

---

## 4. myKatrain 固有の用語

### 4.1 ミス分類（Phase 3）

| 分類 | 目安損失 | 表示 |
|------|----------|------|
| 良 | 0-0.5目 | （表示なし） |
| 軽 | 0.5-2目 | 軽微なミス |
| 悪 | 2-5目 | 悪手 |
| 大悪 | 5目超 | 大悪手（オレンジライン） |

### 4.2 手の自由度（Phase 3）

| 分類 | スコア | 意味 |
|------|--------|------|
| 広い | 0.0-0.25 | 複数の良い手がある |
| 普通 | 0.25-0.5 | 標準的 |
| 狭い | 0.5-0.75 | 選択肢が限られる |
| 一択 | 0.75-1.0 | ほぼ一手しかない |

### 4.3 棋力別プリセット（Phase 4.5）

| プリセット | 対象 | ミス閾値 |
|------------|------|----------|
| beginner | G0-G1 | 緩め（5目以上で大悪手） |
| standard | G2-G3 | 標準（2目以上で悪手） |
| advanced | G4 | 厳しめ（1目以上で悪手） |

---

## 5. カルテ（Karte）の概念（Phase 5以降）

### 5.1 目的
- 1局の要点・弱点・根拠を「診断用まとめ」にする
- LLMに渡して「追加質問→行動ルール」を引き出す

### 5.2 構成要素
- **重要局面**: importance スコア上位の手
- **弱点仮説**: ミス分類・局面タイプから推定
- **アンカー**: 根拠を追跡できる最小情報（手数/座標/損失）

### 5.3 出力形式（予定）
```markdown
# カルテ - [対局名] - YYYY-MM-DD

## 重要局面
| # | 手番 | 座標 | 損失 | 分類 |
|---|------|------|------|------|
| 45 | 黒 | D10 | 3.2目 | 悪手 |

## 弱点仮説
- 厚みの前での無理な攻め

## アンカー
- E#45: D10, loss=3.2, importance=4.1
```

---

## 6. 変更履歴

- 2025-12-30: v1.0 作成（Claude Code移行対応）
